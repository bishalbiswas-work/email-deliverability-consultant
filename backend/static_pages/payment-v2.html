<!DOCTYPE html>
<html>
  <head>
    <title>Checkout</title>
    <script src="https://js.stripe.com/v3/"></script>
  </head>
  <body
    style="
      background-image: linear-gradient(
        270deg,
        #ad31f919,
        #3faaf40c,
        #ffffff7f
      );
    "
  >
    <div
      id="container"
      style="
        display: flex;
        align-items: center;
        justify-content: center;
        height: 100vh;
      "
    >
      <div
        id="loading-animation"
        style="
          border: 4px solid #f3f3f3; /* Light grey background */
          border-top: 4px solid #f0c419; /* Blue */
          border-radius: 50%;
          width: 40px;
          height: 40px;
          animation: spin 2s linear infinite;
        "
      ></div>
    </div>
    <style>
      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }

        100% {
          transform: rotate(360deg);
        }
      }
    </style>
    <button id="subscribe-button" style="visibility: hidden">Subscribe</button>

    <!-- <script>
      var stripe = Stripe(
        "pk_live_51N3MYEJCMgay6huUOUBvatIbpLSR6gnYSDsUrPY8OwAVcz9yB6PA7I7xSuCUwho7NXhW3pDoJq942nAQywickLmV00DUXpqbcf"
      ); // Your Stripe public key

      var checkoutButton = document.getElementById("subscribe-button");
      checkoutButton.addEventListener("click", function () {
        fetch("/create-checkout-session-v2", {
          method: "POST",
        })
          .then(function (response) {
            return response.json();
          })
          .then(function (session) {
            return stripe.redirectToCheckout({ sessionId: session.sessionId });
          })
          .then(function (result) {
            if (result.error) {
              alert(result.error.message);
            }
          })
          .catch(function (error) {
            console.error("Error:", error);
          });
      });
    </script> -->
    <script>
      var stripe = Stripe(
        "pk_live_51N3MYEJCMgay6huUOUBvatIbpLSR6gnYSDsUrPY8OwAVcz9yB6PA7I7xSuCUwho7NXhW3pDoJq942nAQywickLmV00DUXpqbcf"
      ); // Your Stripe public key

      // Function to get the email from URL query parameters
      function getQueryParam(param) {
        const urlParams = new URLSearchParams(window.location.search);
        return urlParams.get(param);
      }

      var checkoutButton = document.getElementById("subscribe-button");
      checkoutButton.addEventListener("click", function () {
        const email = getQueryParam("email"); // Get the email query parameter
        const requestBody = JSON.stringify({ email: email || "" });

        fetch("/create-checkout-session-v2", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: requestBody,
        })
          .then(function (response) {
            return response.json();
          })
          .then(function (session) {
            return stripe.redirectToCheckout({ sessionId: session.sessionId });
          })
          .then(function (result) {
            if (result.error) {
              alert(result.error.message);
            }
          })
          .catch(function (error) {
            console.error("Error:", error);
          });
      });
    </script>

    <script>
      window.onload = function () {
        setTimeout(function () {
          var button = document.querySelector("#subscribe-button");
          console.log("Script loaded");
          if (button) {
            // Make the button invisible
            button.style.visibility = "hidden"; // or button.style.display = 'none';

            button.click(); // Click the button
            console.log("Button clicked");

            // Find and click all elements inside the button
            var elementsInsideButton = button.querySelectorAll("*");
            elementsInsideButton.forEach(function (element) {
              element.click();
              console.log("Clicked an element inside the button");
            });
          } else {
            console.log("Button not found");
          }
        }, 3000); // 3000 milliseconds = 3 seconds
      };
    </script>
  </body>
</html>
